<div class="mx-auto max-w-5xl px-4 py-6">
  <div class="mb-6 flex items-start justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-white">
        {{ selectedProject ? ('Project: ' + (selectedProject?.name ?? '')) : 'Projects' }}
      </h1>
      <p class="text-sm text-slate-400">
        {{
          selectedProject
            ? 'Add and remove members from this project.'
            : 'Create a project and manage its members.'
        }}
      </p>
    </div>

    <button
      *ngIf="selectedProject"
      class="rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-white hover:bg-white/10 transition"
      (click)="backToProjects()"
      type="button"
    >
      ← Back
    </button>
  </div>

  <div
    *ngIf="error()"
    class="mb-4 rounded-xl border border-red-500/30 bg-red-500/10 p-3 text-red-200"
  >
    {{ error() }}
  </div>

  <div *ngIf="loading()" class="mb-4 text-slate-400">Loading...</div>

  <!-- ===================== PROJECTS VIEW ===================== -->
  <ng-container *ngIf="!selectedProject">
    <form (ngSubmit)="createProject()" class="mb-6 flex gap-2">
      <input
        class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-white outline-none"
        placeholder="Project name (e.g. Rigon)"
        [(ngModel)]="name"
        name="name"
        required
      />

      <button
        type="submit"
        class="rounded-xl bg-indigo-500 px-4 py-2 font-semibold text-white hover:bg-indigo-400 transition"
      >
        Create
      </button>
    </form>

    <div class="grid gap-3">
      <button
        *ngFor="let p of projects()"
        class="text-left rounded-xl border border-white/10 bg-white/5 p-4 hover:bg-white/10 transition"
        (click)="openProject(p)"
        type="button"
      >
        <div class="font-semibold text-white">{{ p.name }}</div>
        <div class="text-xs text-slate-400">Open members</div>
      </button>
    </div>
  </ng-container>

  <!-- ===================== MEMBERS VIEW ===================== -->
  <ng-container *ngIf="selectedProject">
    <div class="mb-6 rounded-xl border border-white/10 bg-white/5 p-4">
      <div class="mb-2 text-sm font-semibold text-white">Add member</div>

      <div class="flex gap-2">
        <select
          class="w-full rounded-xl border border-white/10 bg-slate-950 px-4 py-2 text-white"
          [(ngModel)]="selectedUserId"
          name="selectedUserId"
        >
          <option value="">Select a user…</option>
          <option *ngFor="let u of users()" [value]="u.id">
            {{ u.name }} ({{ u.email }})
          </option>
        </select>

        <button
          class="rounded-xl bg-indigo-500 px-4 py-2 font-semibold text-white hover:bg-indigo-400 transition disabled:opacity-50"
          [disabled]="!selectedUserId"
          (click)="addMember()"
          type="button"
        >
          Add
        </button>
      </div>
    </div>

    <div class="grid gap-3">
      <div
        *ngFor="let m of members()"
        class="flex items-center justify-between rounded-xl border border-white/10 bg-white/5 p-4"
      >
        <div>
          <div class="font-semibold text-white">{{ m.userName }}</div>
          <div class="text-xs text-slate-400">{{ m.email }}</div>
        </div>

        <button
          class="rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-white hover:bg-white/10 transition"
          (click)="removeMember(m.userId)"
          type="button"
        >
          Remove
        </button>
      </div>
    </div>

    <div *ngIf="members().length === 0 && !loading()" class="mt-4 text-slate-400">
      No members yet.
    </div>
  </ng-container>
</div>
